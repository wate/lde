- name: post tasks
  hosts: all
  become: yes
  tasks:
    - name: check composer.json
      stat:
        path: /var/www/html/composer.json
      register: result
      tags: always
    - name: create project
      block:
          - name: install oil command
            get_url:
              url: https://get.fuelphp.com/installer.sh
              dest: /usr/local/bin/oil
              mode: +x
            when: php_project_skeleton is defined and php_project_skeleton == 'fuel/fuel'
          - block:
              - name: remove .gitkeep
                file:
                  path: /var/www/html/.gitkeep
                  state: absent
              - name: create project
                composer:
                  command: create-project
                  arguments: "--prefer-dist {{ php_project_skeleton }} ."
                  no_dev: no
                  prefer_dist: yes
                  working_dir: /var/www/html
              - name: recreate .gitkeep
                file:
                  path: /var/www/html/.gitkeep
                  state: touch
            become: no
      when: not result.stat.exists and php_project_skeleton is defined
      tags:
        - create_project_skeleton
