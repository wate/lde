---
- name: allow development ports
  community.general.ufw:
    rule: allow
    port: "{{ item }}"
    proto: any
  loop: "{{ allow_dev_ports | default(['9000']) }}"
- name: remove default install index file
  ansible.builtin.file:
    path: /var/www/html/{{ item }}
    state: absent
  loop:
    - index.nginx-debian.html
- name: setup php project
  block:
    - name: check exists composer.json
      ansible.builtin.stat:
        path: /vagrant/src/composer.json
      register: composer_json_result
    - name: check exists vendor directory
      ansible.builtin.stat:
        path: /vagrant/src/vendor
      register: vendor_dir_result
    - name: install dependency packages
      composer:
        command: install
        working_dir: /vagrant/src/
        no_dev: false
      when:
        - composer_json_result.stat.exists
        - not vendor_dir_result.stat.exists
  become: false
