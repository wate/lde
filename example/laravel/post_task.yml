- name: check composer.json
  stat:
    path: /var/www/html/composer.json
  register: result
  tags: always
- name: create PHP project
  block:
    - block:
        - name: remove .gitkeep
          file:
            path: /var/www/html/.gitkeep
            state: absent
        - name: create project
          composer:
            command: create-project
            arguments: "{{ php_project_skeleton }} ./"
            no_dev: false
            prefer_dist: true
            working_dir: /var/www/html
        - name: recreate .gitkeep
          file:
            path: /var/www/html/.gitkeep
            state: touch
      become: false
  when:
    - not result.stat.exists
    - php_project_skeleton is defined
  tags: create_project_skeleton
- name: recreate .gitkeep
  file:
    path: /var/www/html/.gitkeep
    state: touch
