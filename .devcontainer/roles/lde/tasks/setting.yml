---
# code: language=ansible
- name: Setup PHP project
  become: true
  block:
    - name: Allow development ports
      community.general.ufw:
        rule: allow
        port: "{{ item }}"
        proto: any
      loop: "{{ cakephp_allow_dev_ports | default([]) }}"
    - name: Remove default install index file
      ansible.builtin.file:
        path: /var/www/html/{{ item }}
        state: absent
      loop:
        - index.html
        - index.nginx-debian.html
- name: Create user directory
  ansible.builtin.file:
    path: ~/{{ item }}
    state: directory
    mode: "0755"
  loop:
    - bin
    - .local/bin
- name: Create symlink
  ansible.builtin.file:
    src: /vagrant
    dest: ~/src
    state: link
- name: Inclde setting tasks
  ansible.builtin.include_tasks:
    file: tasks/setting/{{ setting_task | basename }}
  loop: "{{ lookup('fileglob', 'tasks/setting/*.yml', wantlist=True) }}"
  loop_control:
    loop_var: setting_task
