---
- name: Check exists laravel-adminlte
  ansible.builtin.stat:
    path: "{{ php_project_tmp_dir }}/vendor/jeroennoten/laravel-adminlte"
  register: package_result
- name: Setup AdminLTE
  when: package_result.stat.exists
  block:
    - name: Setup AdminLTE
      ansible.builtin.command:
        cmd: php artisan adminlte:install
        creates: "{{ php_project_tmp_dir }}/config/adminlte.php"
        chdir: "{{ php_project_tmp_dir }}"
- name: Setup AdminLTE styled authentication views
  when: laravel_major_version is version('7', '>=')
  block:
    - name: Check exists laravel/ui
      ansible.builtin.stat:
        path: "{{ php_project_tmp_dir }}/vendor/laravel/ui"
      register: package_result
    - name: Setup AdminLTE styled authentication views
      when: package_result.stat.exists
      block:
        - name: Add authentication views
          ansible.builtin.command:
            cmd: php artisan ui bootstrap --auth
            creates: "{{ php_project_tmp_dir }}/resources/views/auth/login.blade.php"
            chdir: "{{ php_project_tmp_dir }}"
          register: execute_artisan_ui_bootstrap_result
        - name: Replace AdminLTE styled authentication views
          ansible.builtin.command:
            cmd: php artisan adminlte:install --only=auth_views --force
            chdir: "{{ php_project_tmp_dir }}"
          when: execute_artisan_ui_bootstrap_result is changed
