---
# code: language=ansible
# Verify web server
- name: Verify web server installation
  ansible.builtin.assert:
    that:
      - ansible_facts.packages[web_server] is defined
    quiet: "{{ assert_quiet_mode }}"
    fail_msg: "Web server ({{ web_server }}) is not installed"
    success_msg: "Web server ({{ web_server }}) is installed"
- name: Verify web server is running
  ansible.builtin.assert:
    that:
      - ansible_facts.services[web_server + '.service'] is defined
      - ansible_facts.services[web_server + '.service']['state'] == 'running'
      - ansible_facts.services[web_server + '.service']['status'] == 'enabled'
    quiet: "{{ assert_quiet_mode }}"
    fail_msg: "Web server ({{ web_server }}) is not running"
    success_msg: "Web server ({{ web_server }}) is running"
- name: Verify web server listening port
  ansible.builtin.assert:
    that:
      - 80 in listen_tcp_posts
    quiet: "{{ assert_quiet_mode }}"
    fail_msg: "Web server is not listening on port 80"
    success_msg: "Web server is listening on port 80"
