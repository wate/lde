開発作業共通ワークフロー
=========================

概要
-------------------------

すべての開発作業(要件定義、調査、設計、実装、テスト、ドキュメント作成)に共通する情報収集手順と基本原則を定義します。

作業フロー
-------------------------

### 情報取得の実行手順

作業開始時に以下の手順で必要最小限の情報を段階的に取得する。

1. 初期コンテキスト分析: 提供された情報から作業内容と必要情報を特定
2. 作業内容別ワークフローの参照: 作業内容に応じたワークフローを確認
3. 主要情報の取得: `read_file`ツールを使用して作業に直接関連するドキュメントのみを取得
4. 情報の精査と抽出: 取得した情報から作業に必要な部分のみを抽出し、過剰な情報は排除
5. 必要時の追加取得: 不足情報がある場合のみ`semantic_search`や`grep_search`で補完

絶対遵守ルール
-------------------------

このセクションの全項目は必須です。

### 情報収集の原則

- 能動的情報収集: タスク開始時に必要な情報を自身で判断し、適切なツールを使用して取得する
- 段階的コンテキスト構築: 最小限の情報で開始し、必要に応じて段階的に詳細情報を取得する
- 作業判定による選択的参照: 作業内容別ワークフローに基づいて必要なドキュメントのみを参照する
- 複合作業時の優先度制御: 主たる作業内容を優先し、必要に応じて追加参照を行う

### 基本作業原則

- 品質優先: 各ワークフローで定義された品質基準への厳格な準拠
- Single Source of Truth: 同じ情報を複数ドキュメントに重複記載しない
    - プロジェクト情報: `docs/index.md`で一元管理
    - 技術情報: `docs/technology.md`で一元管理
    - ユーザー情報: `docs/persona.md`で一元管理
    - 各ドキュメントは参照リンクで接続し、情報の重複を避ける
    - 理由: 情報の重複はメンテナンス負荷と不整合リスクを増大させる
- 段階的進行: 大きな作業は小さなステップに分割して進める
- 記録の徹底: 重要な判断・変更内容を適切に記録する

### Git操作に関する制約

- **コミット禁止**: `git commit`は実行しない。作業の区切りごとに段階的にステージングを活用し、最終的に`git status`で変更内容を表示してユーザーの確認を待つ(ユーザーが明示的にコミットを許可した場合を除く)
- 段階的ステージング: 作業の区切りでステージングに登録し、追加変更は`git diff`でステージング内容との差分を確認しながら進める
- 既存ファイルの更新: `git add -u --sparse` で追跡済みファイルの変更を一括ステージング(誤追加防止)
- 新規ファイルの追加: ファイル作成直後に`git add --sparse <file>`で即座にステージング登録(削除漏れ防止)
- 不要ファイルの削除: ファイルが不要になった場合、`git rm --cached <file>`でステージングから削除し、ユーザーに「このファイルは不要になりました。削除してよろしいですか?: <file>」と確認して許可を得る
- 変更内容の確認:
    - AI作業中: `git diff`でステージング済み内容との差分を確認(作業単位)
    - ユーザー確認時: `git diff --cached`で前回コミットとの差分を確認(タスク単位・最終確認)
- **ユーザー確認必須**: すべての変更内容はユーザーが`git commit`を実行する前に確認する

推奨ルール
-------------------------

このセクションは推奨事項です。

### 効率的な作業進行

- 並列情報収集: 独立した読み取り操作は可能な限り並列実行
- 既存パターンの活用: `grep_search`や`semantic_search`で既存実装パターンを発見
- 段階的詳細化: 概要から詳細へ、必要に応じて深掘り

### ボーイスカウトルール

既存の成果物（コード、ドキュメント等）に触れる際は、以下の小さな改善を併せて実施する:

- 不明瞭な表現を明確に修正
- 不足している説明やコメントを追加
- 未使用の要素を削除
- 明らかなタイポを修正

ただし、以下は別タスクとして分離する:

- 大規模なリファクタリング
- アーキテクチャの変更
- 複数ファイルにまたがる変更

### フィードバック対応

- ユーザーからの指摘・修正依頼は必ず反映する
- 変更の理由と影響範囲を明確に説明する
- 不明点や曖昧な指示があれば質問し、推測で実装しない
- 同じ指摘を繰り返さないよう、指摘内容をセッション内で記憶する
- 複数の指摘や改善案を提示する際は、箇条書きで簡潔にまとめる
- 実施後の詳細な説明は、ユーザーが求めた場合のみ提供する

### 作業記録の管理

- セッション中の重要な判断・変更内容を記録する
- 複雑な作業や長期作業では、進捗状況を定期的に記録する
- ユーザーからの指摘事項と対応内容を明記する
- 次回セッションで必要な情報(未解決課題、技術的判断、前提条件等)を残す
- 作業ログは簡潔に、箇条書きで要点のみ記録する

### ドキュメント記録の推奨

作業中に以下の場合はドキュメントに記録する:

- 複雑なビジネスロジックや技術的判断を行った場合
- 設計の制約や前提条件がコードだけでは伝わりにくい場合
- 将来のメンテナンス時に「なぜこうしたか」が重要になる場合

記録する際の原則:

- 同じ事柄を扱う既存ドキュメントがないか必ず検索・確認する
- 既存ドキュメントがある場合は新規作成せず、既存ドキュメントを更新する
- 類似した内容がある場合は統合を検討する
- 新規作成は既存ドキュメントで対応できない場合のみ行う
- ドキュメントには「なぜそうしたか」の理由と背景を明記する
- 実装完了時にドキュメント不足がないか自己チェックする

参考リンク
-------------------------

### 作業内容別のワークフロー

作業内容に応じて、以下のワークフローを参照してください。

- [要件定義ワークフロー](./requirements.md): 機能要求や制約の明確化
- [調査ワークフロー](./investigation.md): 技術調査、問題分析
- [設計ワークフロー](./design.md): アーキテクチャ、データモデル等の設計
- [実装ワークフロー](./coding.md): コーディング(新規実装、バグ修正、リファクタリング)
- [テストワークフロー](./testing.md): テスト作成・実行
- [ドキュメント作成ワークフロー](./documentation.md): 仕様書、README等の執筆
- [プロジェクト管理ワークフロー](./project-management.md): プロジェクト全体の管理

### プロジェクト基本情報

- [プロジェクトブリーフ](../../docs/index.md): プロジェクト全体の文脈
- [技術スタック](../../docs/technology.md): 使用技術の確認
- [アーキテクチャ](../../docs/architecture.md): システム構成の理解

### 開発環境・ツール

- [ディレクトリ構造](../../docs/directory_structure.md): ファイル配置の確認
- [ローカル開発環境](../../docs/local_development.md): 環境構築・設定
- [チートシート](../../docs/cheat_sheet.md): よく使うコマンドやツール

### 品質・運用

- [コーディング規約](../../docs/code_style.md): コード品質基準
- [テスト方針](../../docs/test_policy.md): テスト品質基準
- [セキュリティポリシー](../../docs/security_policy.md): セキュリティ要件
- [デプロイ手順](../../docs/deployment.md): リリース・デプロイ手順

### その他

- [ペルソナ定義](../../docs/persona.md): ユーザー理解
- [用語集](../../docs/glossary.md): 専門用語の確認
